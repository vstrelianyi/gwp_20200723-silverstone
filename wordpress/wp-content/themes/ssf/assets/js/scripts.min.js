
// MODAL SCRIPT

// Detect ios 11_0_x affected
// NEED TO BE UPDATED if new versions are affected
var ua = navigator.userAgent,
    iOS = /iPad|iPhone|iPod/.test(ua),
//	iOS11 = /OS 11_0_1|OS 11_0_2|OS 11_0_3/.test(ua),
//	iOS11 = /OS 11_(\d+)_?(\d+)?/.test(ua),
    iOS11_0 = /OS 11_0_?(\d+)?/.test(ua),
    iOS11_1 = /OS 11_1_?(\d+)?/.test(ua),
    iOS11_2 = /OS 11_2_?(\d+)?/.test(ua),
    iOS11 = iOS11_0 || iOS11_1 || iOS11_2,
    scrolledPositionBeforeOpenModal;

//alert(ua);
// ios 11 bug caret position
if ( iOS && iOS11 ) {
    // Add CSS class to body
    $("body").addClass("iosBugFixCaret");
}

if(/Android/.test(navigator.appVersion)) {
    window.addEventListener("resize", function() {
        if(document.activeElement.tagName=="INPUT" || document.activeElement.tagName=="TEXTAREA") {
            document.activeElement.scrollIntoView();
        }
    });
}

var block = $('<div>').css({'height':'50px','width':'50px'}),
    indicator = $('<div>').css({'height':'200px'}),
    scrollbarWidth = 0;

$('body').append(block.append(indicator));
var w1 = $('div', block).innerWidth();
block.css('overflow-y', 'scroll');
var w2 = $('div', block).innerWidth();
$(block).remove();
scrollbarWidth = (w1 - w2);


function openModal(hrefModal) {

    if ( iOS && iOS11 ) {
        scrolledPositionBeforeOpenModal = $(document).scrollTop();
    }


    if ($(window).width() < 768) {
        $(hrefModal).fadeIn(100);
        $('body').addClass('modal-opened');
    } else {
        if (scrollbarWidth > 0) {
            $('body, .page-header').css('padding-right', scrollbarWidth);
        }
        $('body').addClass('modal-opened');
        $(hrefModal).fadeIn(200);
    }

}


function closeModals() {

    if (scrollbarWidth > 0) {
        $('.popup-block:not(:hidden)').fadeOut(200, function() {
            $('body, .page-header').css('padding-right', 0);
            $('body, html').removeClass('modal-opened');

            if ( iOS && iOS11 ) {
                $('html, body').scrollTop(scrolledPositionBeforeOpenModal);
            }
        });
    } else {
        $('body, .page-header').css('padding-right', 0);
        $('body, html').removeClass('modal-opened');

        if ( iOS && iOS11 ) {
            $('html, body').scrollTop(scrolledPositionBeforeOpenModal);
        }

        $('.popup-block:not(:hidden)').fadeOut(200);
    }
}

function showThanksModal() {
    $('.popup-block:not(:hidden)').fadeOut(200);

    $('#thanks-popup').fadeIn(200);
}

$('[data-toggle="modal"]').click(function(e) {
    e.preventDefault();

    var hrefModal = $(this).attr('data-target');

    openModal(hrefModal);
});

$('[data-toggle="dismiss"]').click(function(e) {
    e.preventDefault();
    closeModals();
});

$('.popup-block__overlay').click(function(e) {
    var closeButton = $('[data-toggle="dismiss"]');

    if (e.target != this) {
//		return false;
    } else {
        closeModals();
    }
});

$('.brand-mobile-slider').slick({
    slidesToShow: 1,
    slidesToScroll: 1,
    initialSlide: 0,
    arrows: false,
    dots: true,
    infinite: true,
    mobileFirst: true,
    variableWidth: true,
    centerMode: true,
    centerPadding: '30px',
    responsive: [
        {
            breakpoint: 767,
            settings: 'unslick'
        }
    ]

});

$(window).on('resize orientationchange', function() {
    $('.brand-mobile-slider').slick('resize');
});

$('.text-input').on('focusin', function() {
    $(this).parent().addClass('focused');
});

$('.text-input').on('focusout', function() {
    $(this).parent().removeClass('focused');
});

$('.count-block').counterUp({
    time: 1600,
    formatter: function (n) {
        return n.replace(/,/g, ' ');
    }
});

function ssf_move_to(el){

    var targetPos;

    if ($(window).width() > 1199) {
        targetPos = $(el).offset().top - 90;
    }

    if ($(window).width() > 767 && $(window).width() < 1200) {
        targetPos = $(el).offset().top - 139;
    }

    if ($(window).width() < 768) {
        targetPos = $(el).offset().top - 79;
    }


    $('html,body').animate({
        scrollTop: targetPos
    }, 400);
}

$('[data-toggle="anchor"]').click(function(e) {
    e.preventDefault();

    var dataTarget = $(this).attr('data-target');

    ssf_move_to(dataTarget);
});

$(window).scroll(function() {
    var needHeight = 300;


    if ($(this).scrollTop() > needHeight && !($('body').hasClass("scrolled")) ) {
        $('body').addClass("scrolled");
    } else if($(this).scrollTop() <= needHeight && $('body').hasClass("scrolled")) {
        $('body').removeClass("scrolled");
    }

});

$('[data-fancybox]').fancybox({
    mobile : {
        clickSlide : function( current, event ) {
            return current.type === 'image' ? 'toggleControls' : "close";
        }
    },
    clickOutside: "close",
    beforeShow: function(){
        if (scrollbarWidth > 0) {
            $('.page-header').css('padding-right', scrollbarWidth);
        }
    },
    afterClose: function(){
        if (scrollbarWidth > 0) {
            $('.page-header').css('padding-right', 0);
        }
    },
    helpers: {
        overlay : {
            locked: false
        }
    }
});

$('#menu-toggle').click(function(e) {
    e.preventDefault();

    $(this).toggleClass('active');

    $('#header-menu').toggleClass('active');
});

$('.popup-block__overlay').click(function(e) {
    var closeButton = $('[data-toggle="dismiss"]');

    if (e.target != this) {
//		return false;
    } else {
        closeModals();
    }
});


$('[data-toggle="dropdown-toggle"]').click(function(e) {
    e.preventDefault();
    e.stopPropagation();

    var thisHref = $(this).parent().find('.dropdown-menu');

    if ($(thisHref).hasClass('active')) {
        $(thisHref).removeClass('active');
        $(this).removeClass('active');
    } else {
        $('[data-toggle="dropdown-toggle"]').removeClass('active');
        $('.dropdown-menu').removeClass('active');

        $(thisHref).addClass('active');

        $(this).addClass('active');
    }

});

$('.dropdown-menu').click(function(e) {
    e.stopPropagation();
});


$(document).click(function() {
    $('[data-toggle="dropdown-toggle"]').removeClass('active');
    $('.dropdown-menu.active').removeClass('active');
});



$(document).on('click', '.reviews__answer-toggle', function(e){
    e.preventDefault();
    $(e.target).parents('.reviews__item-wrap').toggleClass('active');
});

$('.category-topbar__category-items .cat-item.active').click(function(e) {
    e.preventDefault();

    if ($(window).width() < 768) {
        $('.category-topbar__category-items .inner-list').toggleClass('active');
    }
});

$('.nice-select').niceSelect();

$(".rating-block").rateYo({
    starWidth: "17px",
    normalFill: "#A8A9AB",
    ratedFill: "#344B8E",
    fullStar: true,
    readOnly: true,
    spacing: "7px",
    starSvg: '<svg width="17" height="16" viewBox="0 0 17 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">' +

    '<g id="Canvas" transform="translate(-17817 -495)">' +
    '<g id="Shape">' +
    '<use xlink:href="#path0_fill" transform="translate(17817 495)"/>' +
    '</g>' +
    '</g>' +
    '<defs>' +
    '<path id="path0_fill" d="M 8.90195 0.263541L 11.0643 5.31475L 16.6003 5.78413C 16.9843 5.81685 17.1405 6.28968 16.849 6.53858L 12.6499 10.1291L 13.9082 15.4706C 13.9955 15.8418 13.588 16.1337 13.2581 15.9365L 8.50054 13.1047L 3.74296 15.9365C 3.41223 16.1329 3.00559 15.8409 3.09285 15.4706L 4.35118 10.1291L 0.151211 6.53772C -0.140248 6.28882 0.0150805 5.81599 0.399911 5.78326L 5.93588 5.31389L 8.09826 0.263541C 8.24835 -0.0878471 8.75186 -0.0878471 8.90195 0.263541Z"/>' +
    '</defs>' +
    '</svg>'
});

$(".rate-block").rateYo({
    starWidth: "24px",
    normalFill: "#A8A9AB",
    ratedFill: "#344B8E",
    fullStar: true,
    readOnly: false,
    spacing: "8px",
    starSvg: '<svg width="17" height="16" viewBox="0 0 17 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">' +

    '<g id="Canvas" transform="translate(-17817 -495)">' +
    '<g id="Shape">' +
    '<use xlink:href="#path0_fill" transform="translate(17817 495)"/>' +
    '</g>' +
    '</g>' +
    '<defs>' +
    '<path id="path0_fill" d="M 8.90195 0.263541L 11.0643 5.31475L 16.6003 5.78413C 16.9843 5.81685 17.1405 6.28968 16.849 6.53858L 12.6499 10.1291L 13.9082 15.4706C 13.9955 15.8418 13.588 16.1337 13.2581 15.9365L 8.50054 13.1047L 3.74296 15.9365C 3.41223 16.1329 3.00559 15.8409 3.09285 15.4706L 4.35118 10.1291L 0.151211 6.53772C -0.140248 6.28882 0.0150805 5.81599 0.399911 5.78326L 5.93588 5.31389L 8.09826 0.263541C 8.24835 -0.0878471 8.75186 -0.0878471 8.90195 0.263541Z"/>' +
    '</defs>' +
    '</svg>'
});

$('.product__description-mobile-more').click(function(e) {
    e.preventDefault();

    $(this).parents('.product__top-description').addClass('active');
});

$('.product__main-images-slider').slick({
    slidesToShow: 1,
    slidesToScroll: 1,
    initialSlide: 0,
    arrows: false,
    dots: false,
    infinite: true,
    fade: true,
    swipe: false,
    draggable: false,
    speed: 50,
    responsive: [
        {
            breakpoint: 768,
            settings: {
                dots: true,
                swipe: true,
                fade: false,
                draggable: true,
                speed: 300,
                variableWidth: true,
                centerMode: true,
                centerPadding: '30px',
            }
        }
    ]

});

$('.product__nav-images-slider .item').on('mouseenter', function (e) {
    var $currTarget = $(e.currentTarget),
        index = $currTarget.index(),
        slickObj = $('.product__main-images-slider').slick('getSlick');

    slickObj.slickGoTo(index);

});

$('.product__spec-tab').click(function(e) {
    e.preventDefault();

    var thisTarget = $(this).attr('data-target');

    if ($(window).width() < 768) {
        if ($(this).hasClass('active')) {
            $(this).parent().toggleClass('active');
        } else {
            $(this).addClass('active').siblings().removeClass('active');

            $(thisTarget).addClass('active').siblings().removeClass('active');
            $(this).parent().removeClass('active');
        }
    } else {
        $(this).addClass('active').siblings().removeClass('active');
        $(this).parent().removeClass('active');
        $(thisTarget).addClass('active').siblings().removeClass('active');
    }




});

$('.product__spec-tab-video').click(function(e) {
    $(this).parent().removeClass('active');
});

// comment submit close popup for demo usage

// $('.popup-block .submit-button').click(function(e) {
//     e.preventDefault();
//     var thisTarget = $(this).attr('data-target');
//
//     $('.popup-block:not(:hidden)').fadeOut(200);
//
//     $(thisTarget).fadeIn(100);
// });

(function(){
    var checkForSPS = $('.single-product-support').length;
    if (checkForSPS > 0) {
        doubleTab();
    }
    else {
        simpleTab();
    }
    console.log(checkForSPS);
})();
function simpleTab(){
    $('[data-toggle="tab"]').click(function(e) {
        e.preventDefault();
    
        var thisTarget = $(this).attr('data-target');
    
        $(this).addClass('active').siblings().removeClass('active');
    
        $(thisTarget).addClass('active').siblings().removeClass('active');
    
        $('.support-block__tabs-content-wrap').customScrollbar("scrollToY", 0)
    
        $(".support-block__tabs-content-wrap").customScrollbar('resize', true);
    });
}
function doubleTab() {
    $('.single-product-support [data-toggle="tab"]').click(function (e) {
        e.preventDefault();
        var thisTarget = $(this).attr('data-target');
        $('.support-block__tab-content, .support-info__tab-pane').removeClass('active');
        $('.support-info__tabs a, .support-block__tabs a').removeClass('active');
        $(this).addClass('active');
        $(thisTarget).addClass('active');
    });
    if ($(window).width() < 768) {
        $('.support-info__tabs a').insertAfter('.support-block__tabs a:last-child');
    }

}


// $('#locations-search-wrapper .text-input').focusin(function() {
//     $(this).parent().addClass('opened');

//     $('#locations-search-dropdown').show();

//     $(".customScrollbar").customScrollbar('resize', true);
// });
$('#locations-search-wrapper .text-input').on('input', function(){
    var inputLength = $(this).val().length;
    if (inputLength > 0) {
        $(this).parent().addClass('opened');
        $('#locations-search-dropdown').show();
    }
    $(".customScrollbar").customScrollbar('resize', true);
});

$('#locations-search-wrapper .text-input').focusout(function() {
    setTimeout(function() {
        $(this).parent().removeClass('opened');
        $('#locations-search-dropdown').hide();
    }, 300);
});

$('#location-search-dropdown-close').click(function(e) {
    e.preventDefault();

    $(this).parent().hide();
});

$('#search-popup-wrapper .text-input').focusin(function() {
    $(this).parent().addClass('opened');

    $('#main-search-dropdown').show();

    $(".customScrollbar").customScrollbar('resize', true);
});

// $('#search-popup-wrapper .text-input').focusout(function() {
//     $(this).parent().removeClass('opened');
//
//     $('#main-search-dropdown').hide();
// });

$('#main-search-dropdown-close').click(function(e) {
    e.preventDefault();

    $(this).parent().hide();
});

// if ($(window).width() > 767) {
//     $(".support-block__tabs-content-wrap").customScrollbar({
//         animationSpeed: 20,
//         updateOnWindowResize: true,
//         wheelSpeed: 100,
//         preventDefaultScroll: true,
//         skin: 'default-skin'
//     });
// }

$(".customScrollbar").customScrollbar({
    animationSpeed: 20,
    updateOnWindowResize: true,
    wheelSpeed: 100,
    preventDefaultScroll: true,
    skin: 'default-skin'
});

$('.support-block__tabs').click(function(e) {

    if ($(window).width() < 768) {

        if (!$(this).hasClass('mobile-opened')) {
            e.stopPropagation();
            e.preventDefault();

            $(this).addClass('mobile-opened');
        } else {
            $(this).removeClass('mobile-opened');
        }
    }

});

$('.pay-delivery__top-tabs').click(function(e) {

    if ($(window).width() < 768) {

        if (!$(this).hasClass('mobile-opened')) {
            e.stopPropagation();
            e.preventDefault();

            $(this).addClass('mobile-opened');
        } else {
            $(this).removeClass('mobile-opened');
        }
    }

});

$('.support-info__tabs').click(function(e) {

    if ($(window).width() < 768) {

        if (!$(this).hasClass('mobile-opened')) {
            e.stopPropagation();
            e.preventDefault();

            $(this).addClass('mobile-opened');
        } else {
            $(this).removeClass('mobile-opened');
        }
    }

});

$('.cabinet-block__main-nav').click(function(e) {

    if ($(window).width() < 768) {

        if (!$(this).hasClass('mobile-opened')) {
            e.stopPropagation();
            e.preventDefault();

            $(this).addClass('mobile-opened');
        } else {
            $(this).removeClass('mobile-opened');
        }
    }

});

$('.support-block__show-more').click(function(e) {
    e.preventDefault();

    $(this).parent().addClass('opened-full');
    $(this).remove();
});


$('[data-toggle="slide-toggle"]').click(function(e) {
    e.preventDefault();

    $(this).parent().toggleClass('active');

    $(this).toggleClass('active');

    $(this).next().stop().slideToggle(200);
});

// $('.cart-block__count-wrap .count-button').click(function(e) {
$(document).on('click', '.cart-block__count-wrap .count-button',function(e) {

    e.preventDefault();

    var thisHref = $(this).parent().find('input'),
        thisHrefValue = parseInt($(thisHref).val());

    if ($(this).hasClass('plus')) {
        if (thisHrefValue > 0) {
            $(thisHref).val(thisHrefValue + 1);
            $("[name='update_cart']").prop('disabled', false);
            $("[name='update_cart']").click();
        }
        $(this).parent().find('.disabled').removeClass('disabled');
    } else {
        if (thisHrefValue > 1) {
            $(thisHref).val(thisHrefValue - 1);
            $("[name='update_cart']").prop('disabled', false);
            $("[name='update_cart']").click();
        }

        if (thisHrefValue <= 2) {
            $(this).parent().find('.count-button.minus').addClass('disabled');
        }
    }

});


$('#location-show-more').click(function(e) {
    e.preventDefault();

    $('#location-cities-block').addClass('active');
});

$('#location-show-more-stores').click(function(e) {
    e.preventDefault();

    $('#location-stores-block').addClass('active');
    $(this).hide();
});


$('input[type="file"]').change(function(e){
    for (var i = 0; i < e.target.files.length; i++) {
        if (i == 0) {
            $('#dropContainer .file-name').html("");
        }
        $(this).next().find('.file-name').append(e.target.files[i].name + "<br>")
    }
    // $(this).next().find('.file-name').text(e.target.files[0].name);
});


jQuery.fn.smoothIncreaseNumbers = function (startNum) {
    console.log(startNum);
    var $block = $(this),
        flagShow = true,
        startNum = startNum ? startNum : 0;
    $(window).on('scroll', function () {
        var scrollTop = $(window).scrollTop() + $(window).height();
        var blockOffset = $block.parent().offset().top;
        if (scrollTop >= blockOffset && flagShow) {
            $block.each(function (index, el) {
                var getNum = $(this).text(),
                    chars = getNum.replace(/\d/g, ''),
                    getNum = parseInt(getNum);

                $(this).animate({ num: getNum - startNum }, {
                    duration: 1600,
                    step: function (num) {
                        this.innerHTML = (num + startNum).toFixed();
                    },
                    complete: function () {
                        this.innerHTML = this.innerHTML + chars;
                    }
                });
            });
            flagShow = false;
        }
    });
}
jQuery(document).ready(function($){
    if ($('.num-container .num').length > 0) {
        $('.num-container .num').smoothIncreaseNumbers();
    }
    if ($('.midpage__social').length > 0) {
        $(window).on('scroll', function () {
            var scrollTop = $(window).scrollTop() + $(window).height();
            var blockOffset = $('.midpage__social li').parent().offset().top;
            if (scrollTop >= blockOffset) {
                $('.midpage__social li').each(function(elm, i){
                    console.log(elm)
                    setTimeout(() => {
                        $(this).addClass("appearLeftAnimate");
                    }, elm*500);
                })
            }
        });
    }
    $('a.smooth-link').click(function(e){
        e.preventDefault();
        var target = $(this).attr('href');
        $('html, body').animate({
            scrollTop: $(target).offset().top
        }, 2000);
    });
})

if (typeof dropContainer !== 'undefined'){
    dropContainer.ondragover = dropContainer.ondragenter = function (evt) {
        evt.preventDefault();
    };
    
    dropContainer.ondrop = function (evt) {
        // pretty simple -- but not for IE :(
        addCameraFile.files = evt.dataTransfer.files;
        evt.preventDefault();
        for (var i = 0; i < evt.dataTransfer.files.length; i++) {
            // var file = evt.dataTransfer.items[i].getAsFile();
            if (i==0){
                $('#dropContainer .file-name').html("");
            }
            var name = evt.dataTransfer.files[i].name + "<br>";
            console.log(name);
            $('#dropContainer .file-name').append(name);
        }
    };
}